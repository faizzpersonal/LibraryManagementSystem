<app-admin-navbar></app-admin-navbar>

<div class="container my-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-primary">Fine Management</h2>
    <div>
      <a routerLink="/admin/fines/add" class="btn btn-outline-success me-2">
        <i class="bi bi-plus-circle me-1"></i> Add Fine
      </a>
      <button class="btn btn-outline-secondary" [routerLink]="['/admin-dashboard']">
        <i class="bi bi-arrow-left-circle me-1"></i> Back to Dashboard
      </button>
    </div>
  </div>

  <div class="mb-3">
    <button class="btn btn-outline-secondary me-2" (click)="filterFines('ALL')">All</button>
    <button class="btn btn-outline-success me-2" (click)="filterFines('PAID')">View Paid Fines</button>
    <button class="btn btn-outline-danger" (click)="filterFines('UNPAID')">View Unpaid Fines</button>
  </div>

  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>ID</th>
          <th>User</th>
          <th>Phone</th>
          <th>Book</th>
          <th>Transaction ID</th>
          <th>Amount</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let fine of fines">
          <td>{{ fine.id }}</td>
          <td>{{ fine.transaction.user.name }}</td>
          <td>{{ fine.transaction.user.phone }}</td>
          <td>{{ fine.transaction.book.title }}</td>
          <td>{{ fine.transaction.id }}</td>
          <td>{{ fine.amount }}</td>
          <td>
            <span *ngIf="(fine.status || '').toUpperCase().trim() === 'PAID'" 
                  class="badge bg-success">Paid</span>
            <span *ngIf="(fine.status || '').toUpperCase().trim() === 'UNPAID'" 
                  class="badge bg-danger">Unpaid</span>
          </td>
          <td class="d-flex flex-wrap gap-1">
            <button class="btn btn-outline-primary btn-sm" (click)="editFine(fine.id)">
              <i class="bi bi-pencil-square me-1"></i> Edit
            </button>
            <button class="btn btn-outline-danger btn-sm" (click)="deleteFine(fine.id)">
              <i class="bi bi-trash me-1"></i> Delete
            </button>
            <button class="btn btn-outline-success btn-sm" *ngIf="fine.status?.toUpperCase() === 'UNPAID'"  
                    (click)="markAsPaid(fine.id)">
              <i class="bi bi-check-circle me-1"></i> Mark as Paid
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
